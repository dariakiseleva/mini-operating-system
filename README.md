# Summary

The mini OS can execute simple commands, like storing values in variables and printing words or variable values. Programs are simulated by files with lines of commands. Programs are assigned PCBs and scheduled, intially with different policies like First-Come-First-Serve or Round Robin.

In this assignment, we do not load the entire code of all files to the temporary memory. The temporary memory is divided into frames which can fit a page, a page is three lines of code. We simulate a disk by copying files into a sub-directory within the current directory and load their content into memory from there.

Initially, only the first two pages of each file are loaded into the frame store. Then, when the file still has pages to run but they are not in memory, it will load them into free space in memory. A *page fault* occurs when there is no free space in memory and the *least recently used* frame is emptied of its contents. Note that there is no privacy - a page fault generated by process P1 can evict a page belonging to process P2.

The description of the assignment is [provided in PDF](./Assignment3Winter2022.pdf). 
This solution is based on the given (imperfect) [solution to Assignment 2](./A2Solution/).


# Limitations
* Unlike Assignment 2, the `exec` function can only run with the Round Robin (RR) policy, specifically with the timeslice of 2. Extra code responsible for other policies has been mostly removed.
* What is called the CPU function does not truly function like a CPU, it directly changes the properties of the PCB, there is no loading etc. It was completely remade from the Assignment 2 solution where it really tried to simulate a simple CPU.
* A bit disorganized where some random helper functions end up, e.g. the `file_has_page` helper function is in `cpu.c`.
* There is a way to reset the variable store with the `resetmem` command, but if the frame store is full it will simply display an error and not run any more commands. Kicking pages out only happens within the same `exec` or `run` command.
* There is some ugly code about e.g. checking if the file has enough lines to have a page of some number, it does it by iterating through the whole file every time. The number of pages of the file should have been stored in the PCB, or handled otherwise. Maybe by somehow accessing the line of a certain index *in a file*. 
* Perhaps redundant import statements in .c and header files, unsure


# Execution

`make clean`

`make make mysh framesize=X varmemsize=Y`

Where X is the space for frames in memory and must be a multiple of 3, and Y is the space for variable value storage.

`./mysh < testfile.txt`

Where `testfile.txt` is e.g.
> exec prog10 prog11 prog12 RR

And file contents in e.g. `prog10` are:
<blockquote>

echo P10L1

set a PTenLineTwoSet; print a

echo P10L3

echo $a

echo P10L5

set a PTenLineSixSet; echo $a

echo P10L7
</blockquote>



# Testing
Folder [A3_testcases_public](./A3_testcases_public/) contains test files and expected results.

*Below is a shortcut to execute tests while keeping them in a subfolder.*


## Testing quick commands
### Test 1

<blockquote> 
make clean; make mysh framesize=18 varmemsize=10; ./mysh
exec A3_testcases_public/prog1 A3_testcases_public/prog2 A3_testcases_public/prog3 RR
</blockquote>

[Expected results](./A3_testcases_public/tc1_result)

### Test 2

<blockquote> 
make clean; make mysh framesize=18 varmemsize=10; ./mysh
exec A3_testcases_public/prog4 A3_testcases_public/prog5 A3_testcases_public/prog6 RR
</blockquote>

[Expected results](./A3_testcases_public/tc2_result)

### Test 3

<blockquote> 
make clean; make mysh framesize=21 varmemsize=10; ./mysh
exec A3_testcases_public/prog7 A3_testcases_public/prog8 A3_testcases_public/prog9 RR
</blockquote>

[Expected results](./A3_testcases_public/tc3_result)

### Test 4

<blockquote> 
make clean; make mysh framesize=18 varmemsize=10; ./mysh
exec A3_testcases_public/prog10 A3_testcases_public/prog11 A3_testcases_public/prog12 RR
</blockquote>

[Expected results](./A3_testcases_public/tc4_result)

### Test 5

<blockquote> 
make clean; make mysh framesize=6 varmemsize=10; ./mysh
run A3_testcases_public/prog8
</blockquote>

[Expected results](./A3_testcases_public/tc5_result)